From 8914ba67b0add6395e3c2b8d3a5d5c95e8292f37 Mon Sep 17 00:00:00 2001
From: Martijn van de Rijdt <martijn@enketo.org>
Date: Tue, 15 Sep 2015 15:36:56 -0600
Subject: [PATCH] clean up (+3 squashed commits) Squashed commits: [9e11d5b]
 fixes reset button triggering slider stop event [f8e72db] center current
 value box [7a39999] vertical scale styling, reset button, 0 is min

---
 src/widget/analog-scale/analog-scalepicker.js   | 42 ++++++++-------
 src/widget/analog-scale/analog-scalepicker.scss | 69 ++++++++++++++++++-------
 src/widget/distress/distresspicker.scss         |  2 -
 3 files changed, 73 insertions(+), 40 deletions(-)

diff --git a/src/widget/analog-scale/analog-scalepicker.js b/src/widget/analog-scale/analog-scalepicker.js
index 07c6bec..da781c3 100644
--- a/src/widget/analog-scale/analog-scalepicker.js
+++ b/src/widget/analog-scale/analog-scalepicker.js
@@ -44,7 +44,7 @@ define( function( require, exports, module ) {
 
         $( this.element ).slider( {
             reversed: true,
-            min: -1,
+            min: 0,
             max: 100,
             orientation: this.orientation,
             step: 1,
@@ -52,8 +52,8 @@ define( function( require, exports, module ) {
         } );
         this.$widget = $( this.element ).next( '.widget' );
         this.$slider = this.$widget.find( '.slider' );
+        this._renderResetButton();
         this._renderLabels();
-        //this._addValueBox();
         this._renderScale();
         this._setChangeHandler();
     };
@@ -67,8 +67,6 @@ define( function( require, exports, module ) {
             return label.trim();
         } );
 
-        console.debug( 'label', labels ); // DEBUG
-
         this.$mainLabel = this.$mainLabel || $( '<span class="widget question-label active" />' ).insertAfter( $labelEl );
         this.$mainLabel.empty().append( labels[ 0 ] );
 
@@ -80,40 +78,48 @@ define( function( require, exports, module ) {
 
         if ( labels[ 3 ] ) {
             this.$showValue = this.$showValue || $( '<div class="show-value" />' ).insertBefore( this.element );
-            this.$showValue.empty().append( labels[ 3 ] + '<span class="value">' + this.element.value + '</span>' );
+            this.$showValue.empty().append( '<div class="show-value__box">' + labels[ 3 ] +
+                '<span class="show-value__value">' + this.element.value + '</span></div>' );
         } else if ( this.$showValue ) {
             this.$showValue.remove();
             this.$showValue = undefined;
         }
     };
 
-    Analogscalepicker.prototype._renderValueBox = function() {
-        this.$widget.append(
-            '<div class="value-box"></div>'
-        );
-    };
-
     Analogscalepicker.prototype._renderScale = function() {
         var $scale = $( '<div class="scale"></div>' );
         for ( var i = 100; i >= 0; i -= 10 ) {
-            $scale.append( '<div class="number"><div class="value">' + i + '</div><div class="ticks"></div></div>' );
+            $scale.append( '<div class="number"><div class="ticks"></div><div class="value">' + i + '</div></div>' );
         }
         this.$slider.prepend( $scale );
     };
 
+    Analogscalepicker.prototype._renderResetButton = function() {
+        var that = this;
+
+        $( '<button class="btn-icon-only btn-reset"><i class="icon icon-refresh"></i></button>' )
+            .appendTo( this.$widget )
+            .on( 'click', function( evt ) {
+                $( that.element ).slider( 'setValue', 0, false );
+                $( that.element ).val( '' ).trigger( 'change' );
+                that._updateCurrentValueShown();
+                return false;
+            } );
+    };
+
+    Analogscalepicker.prototype._updateCurrentValueShown = function() {
+        this.$showValue.find( '.show-value__value' ).text( this.element.value );
+    };
+
     /**
      * Set delegated event handlers
      */
     Analogscalepicker.prototype._setChangeHandler = function() {
         var that = this;
+
         $( this.element ).on( 'slideStop.' + this.namespace, function( slideEvt ) {
-            // set to empty if value = -1
-            if ( Number( this.value ) === -1 ) {
-                this.value = '';
-            }
-            console.debug( 'updating value', this.value ); //DEBUG
-            that.$showValue.find( '.value' ).text( this.value );
             $( this ).trigger( 'change' );
+            that._updateCurrentValueShown();
         } );
     };
 
diff --git a/src/widget/analog-scale/analog-scalepicker.scss b/src/widget/analog-scale/analog-scalepicker.scss
index 58a6ba8..b175612 100644
--- a/src/widget/analog-scale/analog-scalepicker.scss
+++ b/src/widget/analog-scale/analog-scalepicker.scss
@@ -1,16 +1,27 @@
 $tick-color: black;
 $border: 1px solid $tick-color;
-$handle-color: red;
+$handle-color: #d42c2c;
 $width: 150px;
+$min-height: 800px;
+$question-margin: 20px;
 
 .or-appearance-analog-scale {
-    min-height: 400px;
+    position: relative;
+    min-height: $min-height;
     // using a dirty trick, knowing that only only question-labels with a lang attribute
     // are switched when the language changes
     .question-label.active[lang] {
         display: none;
     }
+    .question-label.active,
+    .or-hint.active,
+    .show-value {
+        width: calc(100% - #{$width} - #{$question-margin});
+    }
     .slider-vertical {
+        position: absolute;
+        top: $question-margin;
+        right: $question-margin;
         width: $width;
     }
     .slider-vertical .slider {
@@ -35,66 +46,84 @@ $width: 150px;
     }
     .slider-handle {
         background: $handle-color;
+        opacity: 0.9;
+        //outline: 0;
+   
     }
     .slider-selection {
         background: transparent;
         border-radius: 0;
     }
+    .btn-reset {
+        position: absolute;
+        bottom: 50px;
+        left: 100px;
+    }
     .scale {
         @include font-normal;
         height: 100%;
         position: absolute;
         //top: -1px;
-        left: -5px;
+        left: -6px;
         font-size: 12px;
         .number {
+            position: relative;
+            //border: 1px solid green;
             line-height: 16px;
-            height: 9.09%;
+            height: 10%;
             width: 30px;
-            border-bottom: $border;
+            border-top: $border;
+            background-image: linear-gradient(90deg, $tick-color 1px, transparent 0px);
+            background-repeat: no-repeat;
+            background-size: 52% 100%;
+            background-position: right;
             &:last-child {
-                //display: none;
-           
+                height: 0;
             }
         }
         .ticks {
+            //border: 1px solid red;
             width: 50%;
             height: 100%;
             margin-left: 25%;
             background-image: linear-gradient(0deg, $tick-color 1px, transparent 0px);
             background-repeat: repeat;
-            background-size: 100% 10%;
+            background-origin: border-box;
+            background-size: 100% 10.2%;
         }
         .value {
-            position: relative;
-            top: 50%;
+            position: absolute;
+            //border: 1px solid blue;
+            top: -9px;
             left: -25px;
             width: 20px;
             text-align: center;
         }
+        .value-0 {}
     }
     .max-label,
     .min-label {
         text-align: center;
-        //max-width: $width
-   
     }
     .show-value {
+        width: calc(100% - $width);
+    }
+    .show-value__box {
         background-color: black;
         text-align: center;
         color: white;
         width: 170px;
         padding: 10px 35px;
-        margin: 10px;
+        margin: 20px auto;
         @extend h5;
         @include font-normal;
-        .value {
-            margin-top: 3px;
-            display: block;
-            min-width: 1px;
-            min-height: 23px;
-            @extend h4;
-        }
+    }
+    .show-value__value {
+        margin-top: 3px;
+        display: block;
+        min-width: 1px;
+        min-height: 23px;
+        @extend h4;
     }
 }
 
diff --git a/src/widget/distress/distresspicker.scss b/src/widget/distress/distresspicker.scss
index 6365691..bc98759 100644
--- a/src/widget/distress/distresspicker.scss
+++ b/src/widget/distress/distresspicker.scss
@@ -40,8 +40,6 @@ $green: rgb(60, 182, 67);
             border-radius: $inner-width / 2;
             background: $handle-color;
             margin: ($width - $inner-width - 2px) / 2;
-            //  17px;
-       
         }
     }
     .slider-vertical .slider-track {
-- 
2.2.1

